import{j as e,L as U,u as xe,r as N}from"./router-Cw9W2VPt.js";import{C as A,a as O,d as D,g as k,B as x,I as M,f as T}from"./shadcn-D0D_yQn8.js";import{R as Q,d as _,L as v,e as V,l as ee,m as fe,n as je,y as p,o as ge,p as ve,f as ye,g as Ne,u as Se}from"./index-C-cGNFZt.js";import{k as Ce,B as we,m as W,h as Pe,M as be,P as Ee,T as Ie}from"./icons-lkuTPY-4.js";import{S as K,a as J,b as Z,c as H,d as X}from"./select-Baesy25u.js";import{I as Ae}from"./products-P04FZvIx.js";import{b as ke}from"./cart-BewrXa47.js";import{a as Re,b as Te}from"./user-ByFsq5Pz.js";import{N as Le}from"./NotAuthorizedPage-CcSqDRpC.js";import"./vendor-DJG_os-6.js";import"./ui-BRLOXzHy.js";import"./utils-CjxovF-h.js";import"./redux-BWM5Hhun.js";import"./query-UWIsBdtC.js";import"./wishlist-BALm09WR.js";import"./forms-CL1apIa9.js";const Fe=({children:t})=>e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Checkout"}),t]})})}),Oe=({leftColumn:t,rightColumn:s})=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:t}),e.jsx("div",{className:"lg:col-span-1",children:s})]}),De=({paymentMethod:t,setPaymentMethod:s,children:r})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(A,{children:[e.jsx(O,{children:e.jsx(D,{children:"Shipping Address"})}),e.jsx(k,{children:r})]}),e.jsxs(A,{children:[e.jsx(O,{children:e.jsx(D,{children:"Payment Method"})}),e.jsx(k,{children:e.jsxs(Q,{value:t,onValueChange:s,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{value:"stripe",id:"stripe"}),e.jsxs(v,{htmlFor:"stripe",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Credit/Debit Card (Stripe)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{value:"cod",id:"cod"}),e.jsxs(v,{htmlFor:"cod",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(we,{className:"h-4 w-4"}),"Cash on Delivery"]})]})]})})]})]}),_e=({profile:t,isEditingAddress:s,onEditAddress:r,children:n})=>{const i=!t?.firstName||!t?.lastName,d=t?.addresses?.[0];return i?e.jsx(A,{className:"border-orange-200 bg-orange-50",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-800 mb-2",children:"Complete Your Profile"}),e.jsx("p",{className:"text-orange-700 mb-4",children:"Please complete your profile information in Settings first."}),e.jsx(U,{to:"/settings",children:e.jsx(x,{variant:"outline",className:"border-orange-300 text-orange-700",children:"Go to Settings"})})]})})}):s?e.jsx("div",{children:n}):e.jsx("div",{className:"space-y-4",children:d?e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(W,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[d.street,", ",d.city]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.state," ",d.zipCode]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d.country})]})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:r,className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"Edit"]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Address Added"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Please add a shipping address to continue."}),e.jsx(x,{onClick:r,children:"Add Address"})]})})},ze=({addressForm:t,cities:s,onAddressInputChange:r,onSaveAddress:n,onCancelEdit:i,isLoading:d=!1})=>e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(v,{htmlFor:"state",children:"State *"}),e.jsxs(K,{value:t.state,onValueChange:o=>r("state",o),children:[e.jsx(J,{children:e.jsx(Z,{placeholder:"Select your state"})}),e.jsx(H,{children:Ae.map(o=>e.jsx(X,{value:o,children:o},o))})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(v,{htmlFor:"city",children:"City *"}),e.jsxs(K,{value:t.city,onValueChange:o=>r("city",o),disabled:!t.state,children:[e.jsx(J,{children:e.jsx(Z,{placeholder:"Select your city"})}),e.jsx(H,{children:s.map(o=>e.jsx(X,{value:o,children:o},o))})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(v,{htmlFor:"street",children:"Street Address *"}),e.jsx(M,{id:"street",value:t.street,onChange:o=>r("street",o.target.value),placeholder:"Enter your street address",required:!0})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"zipCode",children:"ZIP Code *"}),e.jsx(M,{id:"zipCode",value:t.zipCode,onChange:o=>r("zipCode",o.target.value),placeholder:"Enter ZIP code",pattern:"[0-9]{6}",title:"Please enter a valid 6-digit ZIP code",required:!0})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"country",children:"Country"}),e.jsx(M,{id:"country",value:t.country,disabled:!0,className:"bg-gray-50"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(x,{type:"submit",disabled:d,children:d?"Saving...":"Save Address"}),e.jsx(x,{type:"button",variant:"outline",onClick:i,children:"Cancel"})]})]}),qe=({cartItems:t,subtotal:s,shippingCost:r,totalPrice:n,deliveryOption:i,onDeliveryOptionChange:d,onUpdateQuantity:o,onRemoveItem:f,onPlaceOrder:j,isProcessing:u,isProfileIncomplete:a})=>t.length===0?e.jsxs(A,{children:[e.jsx(O,{children:e.jsx(D,{children:"Order Summary"})}),e.jsx(k,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:"Your cart is empty"}),e.jsx(x,{variant:"outline",className:"mt-4",asChild:!0,children:e.jsx(U,{to:"/products",children:"Continue Shopping"})})]})})]}):e.jsxs(A,{children:[e.jsx(O,{children:e.jsx(D,{children:"Order Summary"})}),e.jsxs(k,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:t.map(l=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:l.images?.[0]||"/placeholder-image.jpg",alt:l.title,className:"w-16 h-16 object-cover rounded-md"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:l.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[T(l.price,"INR")," Ã— ",l.quantity]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:()=>o(l._id,l.quantity-1),disabled:u,children:e.jsx(be,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-8 text-center text-sm",children:l.quantity}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>o(l._id,l.quantity+1),disabled:u,children:e.jsx(Ee,{className:"h-3 w-3"})}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>f(l._id),disabled:u,className:"ml-2",children:e.jsx(Ie,{className:"h-3 w-3"})})]})]},l._id))}),e.jsx(V,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Delivery Options"}),e.jsxs(Q,{value:i,onValueChange:l=>d(l),className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{value:"regular",id:"checkout-regular"}),e.jsxs(v,{htmlFor:"checkout-regular",className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Regular Delivery"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s>=3e3?"Free":s>=2e3?"â‚¹99":"â‚¹199"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"3-5 business days"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{value:"express",id:"checkout-express"}),e.jsxs(v,{htmlFor:"checkout-express",className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Express Delivery"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s>=3e3?"â‚¹199":s>=2e3?"â‚¹299":"â‚¹399"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"1-2 business days"})]})]})]})]}),e.jsx(V,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:T(s,"INR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{children:r===0?"Free":T(r,"INR")})]}),e.jsx(V,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:T(n,"INR")})]})]}),e.jsx(x,{variant:"outline",className:"w-full",asChild:!0,children:e.jsx(U,{to:"/products",children:"Continue Shopping"})}),e.jsx(x,{onClick:j,disabled:u||a,className:"w-full",children:u?"Processing...":a?"Complete Profile to Continue":"Complete Order"})]})]});var se="basil",Me=function(s){return s===3?"v3":s},re="https://js.stripe.com",Ve="".concat(re,"/").concat(se,"/stripe.js"),Ue=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Be=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var Ge=function(s){return Ue.test(s)||Be.test(s)},We=function(){for(var s=document.querySelectorAll('script[src^="'.concat(re,'"]')),r=0;r<s.length;r++){var n=s[r];if(Ge(n.src))return n}return null},Y=function(s){var r="",n=document.createElement("script");n.src="".concat(Ve).concat(r);var i=document.head||document.body;if(!i)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(n),n},Ke=function(s,r){!s||!s._registerWrapper||s._registerWrapper({name:"stripe-js",version:"7.6.1",startTime:r})},E=null,L=null,F=null,Je=function(s){return function(r){s(new Error("Failed to load Stripe.js",{cause:r}))}},Ze=function(s,r){return function(){window.Stripe?s(window.Stripe):r(new Error("Stripe.js not available"))}},He=function(s){return E!==null?E:(E=new Promise(function(r,n){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe){r(window.Stripe);return}try{var i=We();if(!(i&&s)){if(!i)i=Y(s);else if(i&&F!==null&&L!==null){var d;i.removeEventListener("load",F),i.removeEventListener("error",L),(d=i.parentNode)===null||d===void 0||d.removeChild(i),i=Y(s)}}F=Ze(r,n),L=Je(n),i.addEventListener("load",F),i.addEventListener("error",L)}catch(o){n(o);return}}),E.catch(function(r){return E=null,Promise.reject(r)}))},Xe=function(s,r,n){if(s===null)return null;var i=r[0],d=i.match(/^pk_test/),o=Me(s.version),f=se;d&&o!==f&&console.warn("Stripe.js@".concat(o," was loaded on the page, but @stripe/stripe-js@").concat("7.6.1"," expected Stripe.js@").concat(f,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var j=s.apply(void 0,r);return Ke(j,n),j},I,te=!1,ae=function(){return I||(I=He(null).catch(function(s){return I=null,Promise.reject(s)}),I)};Promise.resolve().then(function(){return ae()}).catch(function(t){te||console.warn(t)});var Ye=function(){for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];te=!0;var i=Date.now();return ae().then(function(d){return Xe(d,r,i)})};const $e=Ye("pk_test_51RpU9FSeAwJZ3k95ubuWevCad8Fm0xkjvyxjTLt9GWECf1nABTop1010FjYXeWqu81NRkEpntZGrRomBS0dbTa3t00R8rKJckq"),Qe=()=>{const t=xe(),s=ee(),{processing:r,currentPayment:n,error:i}=fe(u=>u.paymentState),d=async u=>{try{console.log("ðŸ’° Creating Stripe payment intent..."),console.log("ðŸ“¦ Payment data for Stripe:",u);const a=await s(ge(u)).unwrap();console.log("âœ… Payment intent created:",a);const l=await $e;if(!l)throw new Error("Failed to load Stripe");console.log("ðŸŽ¯ Redirecting to Stripe checkout...");const{error:h}=await l.redirectToCheckout({sessionId:a.sessionId});if(h)throw console.error("âŒ Stripe redirect error:",h),p.error(h.message||"Failed to redirect to payment"),h;return a}catch(a){throw console.error("âŒ Stripe payment error:",a),console.error("âŒ Error details:",{message:a.message,response:a.response?.data,status:a.response?.status}),p.error(a.message||"Failed to process payment"),a}},o=async u=>{try{console.log("ðŸ’µ Creating Cash on Delivery order..."),console.log("ðŸ“¦ Payment data for COD:",u);const a=await s(ve(u)).unwrap();return console.log("âœ… COD order created:",a),p.success(`Order placed successfully! Order ID: ${a.orderId}`),await s(ke()).unwrap(),console.log("ðŸ›’ Cart cleared after successful order"),t({to:"/orders"}),a}catch(a){throw console.error("âŒ COD order error:",a),console.error("âŒ Error details:",{message:a.message,response:a.response?.data,status:a.response?.status}),p.error(a.message||"Failed to place order"),a}};return{isProcessing:r,paymentIntent:n,processPayment:async(u,a)=>{try{if(console.log("ðŸš€ Starting payment processing..."),console.log("ðŸ’³ Payment method:",u),console.log("ðŸ“¦ Payment data:",a),u==="stripe")return console.log("ðŸ’³ Processing Stripe payment..."),await d(a);if(u==="cod")return console.log("ðŸ’µ Processing Cash on Delivery..."),await o(a);throw new Error("Invalid payment method")}catch(l){throw console.error("âŒ Payment processing error:",l),l}},handlePaymentConfirmation:async(u,a)=>{try{return console.log("âœ… Confirming payment..."),s(je({orderId:a,status:"completed"})),console.log("âœ… Payment confirmed"),p.success("Payment confirmed successfully!"),{success:!0}}catch(l){throw console.error("âŒ Payment confirmation error:",l),p.error(l.message||"Failed to confirm payment"),l}},error:i}},$={Maharashtra:["Mumbai","Pune","Nagpur","Thane","Nashik"],"Tamil Nadu":["Chennai","Coimbatore","Madurai","Salem","Tiruchirappalli"],Gujarat:["Ahmedabad","Surat","Vadodara","Rajkot","Bhavnagar"],Karnataka:["Bangalore","Mysore","Hubli","Mangalore","Belgaum"],"Uttar Pradesh":["Lucknow","Kanpur","Varanasi","Agra","Prayagraj"],"West Bengal":["Kolkata","Howrah","Durgapur","Asansol","Siliguri"],Telangana:["Hyderabad","Warangal","Karimnagar","Nizamabad","Khammam"]},es=()=>{const t=ee(),{profile:s,isLoading:r}=ye(),{items:n,getTotalPrice:i,updateQuantity:d,removeFromCart:o}=Ne(),f=n,{isProcessing:j,processPayment:u}=Qe(),[a,l]=N.useState("stripe"),[h,z]=N.useState("regular"),[S,C]=N.useState(!1),[q,R]=N.useState([]),[g,w]=N.useState({street:"",city:"",state:"",zipCode:"",country:"India"}),P=i(),G=((c,m)=>c==="regular"?m>=3e3?0:m>=2e3?99:199:m>=3e3?199:m>=2e3?299:399)(h,P),ne=P+G;N.useEffect(()=>{g.state&&$[g.state]?R($[g.state]):R([])},[g.state]),N.useEffect(()=>{const c=s?.addresses?.[0];c&&!S&&w({street:c.street||"",city:c.city||"",state:c.state||"",zipCode:c.zipCode||"",country:"India"})},[s?.addresses,S]);const ie=(c,m)=>{w(y=>({...y,[c]:m}))},oe=()=>{C(!0)},le=async c=>{c.preventDefault();try{if(s?.addresses?.[0]){const m=s.addresses[0]._id;await t(Re({addressId:m,address:g})).unwrap(),p.success("Address updated successfully")}else await t(Te(g)).unwrap(),p.success("Address added successfully");C(!1)}catch(m){const y=m instanceof Error?m.message:typeof m=="string"?m:"Failed to save address";p.error(y)}},ce=()=>{C(!1);const c=s?.addresses?.[0];c&&w({street:c.street||"",city:c.city||"",state:c.state||"",zipCode:c.zipCode||"",country:"India"})},de=async(c,m)=>{m<=0?await o(c):await d(c,m)},me=async c=>{await o(c)},ue=c=>{z(c)},pe=async()=>{const c=s?.addresses?.[0];if(!c){p.error("Please add a shipping address");return}if(n.length===0){p.error("Your cart is empty");return}console.log("ðŸ›’ Cart items:",n),console.log("ðŸ“ Default address:",c),console.log("ðŸ‘¤ Profile:",s),console.log("ðŸ’³ Payment method:",a),console.log("ðŸšš Delivery option:",h);try{const m=f.map(b=>({productId:b._id,name:b.title,price:b.price,quantity:b.quantity,image:b.images?.[0]||""}));console.log("ðŸ”„ Transformed items:",m);const y={items:m,shippingAddress:c,customerDetails:{email:s.email,firstName:s.firstName,lastName:s.lastName,phone:s.phone||""},deliveryOption:h};console.log("ðŸ’° Payment data:",y),await u(a,y)}catch(m){const y=m instanceof Error?m.message:typeof m=="string"?m:"Failed to process payment";p.error(y)}},he=!s?.firstName||!s?.lastName;return{profile:s,cartItems:n,subtotal:P,shippingCost:G,totalPrice:ne,paymentMethod:a,deliveryOption:h,isEditingAddress:S,cities:q,addressForm:g,isProcessing:j,addressLoading:r,isProfileIncomplete:he,setPaymentMethod:l,handleAddressInputChange:ie,handleEditAddress:oe,handleSaveAddress:le,handleCancelEdit:ce,handleUpdateQuantity:de,handleRemoveItem:me,handleDeliveryOptionChange:ue,handlePlaceOrder:pe}},ss=()=>{const{profile:t,cartItems:s,subtotal:r,shippingCost:n,totalPrice:i,paymentMethod:d,deliveryOption:o,isEditingAddress:f,cities:j,addressForm:u,isProcessing:a,addressLoading:l,isProfileIncomplete:h,setPaymentMethod:z,handleAddressInputChange:S,handleEditAddress:C,handleSaveAddress:q,handleCancelEdit:R,handleUpdateQuantity:g,handleRemoveItem:w,handleDeliveryOptionChange:P,handlePlaceOrder:B}=es();return e.jsx(Fe,{children:e.jsx(Oe,{leftColumn:e.jsx(De,{paymentMethod:d,setPaymentMethod:z,children:e.jsx(_e,{profile:t,isEditingAddress:f,onEditAddress:C,children:e.jsx(ze,{addressForm:u,cities:j,onAddressInputChange:S,onSaveAddress:q,onCancelEdit:R,isLoading:l})})}),rightColumn:e.jsx(qe,{cartItems:s,subtotal:r,shippingCost:n,totalPrice:i,deliveryOption:o,onDeliveryOptionChange:P,onUpdateQuantity:g,onRemoveItem:w,onPlaceOrder:B,isProcessing:a,isProfileIncomplete:h})})})},gs=function(){const{data:s,isPending:r}=Se();return r?e.jsx("div",{className:"flex justify-center items-center h-96",children:"Loading..."}):s?e.jsx(ss,{}):e.jsx(Le,{})};export{gs as component};
